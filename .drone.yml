---
kind: pipeline
name: node-latest

steps:
- name: db-setup
  image: mysql
  commands:
  - sleep 30
  - mysql -u root -h helpyadb --execute="SELECT VERSION();"

- name: test
  image: node:latest
  commands:
  - npm install
  - npm test
  env:
  - NODE_ENV=test
  - NODE_PORT=8080
  - NODE_HOST=localhost
  - NODE_DB_PORT=3306


services:
- name: database
  image: mysql
  ports:
  - 33306
  environment:
    MYSQL_ALLOW_EMPTY_PASSWORD: 'yes'
    MYSQL_DATABASE: helpyadb

---
kind: pipeline
name: node14

steps:
- name: test
  image: node:14
  commands:
  - npm install
  - npm test

...