---
kind: pipeline
name: node-latest

steps:
- name: db-setup
  image: mysql
  commands:
  - sleep 30
  - while ! mysqladmin ping -h database -u root; do sleep 1; done
  - mysql -h database -u root -e "CREATE TABLE IF NOT EXISTS database.pipelines (id INT AUTO_INCREMENT PRIMARY KEY, name VARCHAR(50) NOT NULL);"

- name: test
  image: node:latest
  commands:
  - npm install
  - npm test


services:
- name: database
  image: mysql
  ports:
  - 3306
  environment:
    MYSQL_ALLOW_EMPTY_PASSWORD: 'yes'
    MYSQL_DATABASE: helpyadb


...